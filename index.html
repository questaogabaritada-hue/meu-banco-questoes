<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MENTOR IA - SIMULADOR DE BANCA</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #1e293b; --dark: #0f172a; --accent: #dc2626; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: var(--text); line-height: 1.6; }
        
        /* Layout */
        #main-container { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
        .card { background: white; padding: 40px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.04); border: 1px solid #e2e8f0; position: relative; }
        
        /* Formul√°rio de Perfil */
        .setup-group { margin-bottom: 20px; text-align: left; }
        label { font-weight: 700; font-size: 0.9rem; color: var(--dark); display: block; margin-bottom: 8px; }
        input, textarea { width: 100%; padding: 14px; border-radius: 10px; border: 2px solid #e2e8f0; font-family: inherit; font-size: 1rem; box-sizing: border-box; }
        textarea { height: 100px; resize: none; }
        
        /* Interface de Quest√µes */
        .q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #f1f5f9; }
        .q-badge { background: #eff6ff; color: var(--primary); padding: 6px 14px; border-radius: 20px; font-weight: 800; font-size: 0.75rem; text-transform: uppercase; }
        
        .enunciado { font-size: 1.2rem; color: var(--dark); margin-bottom: 30px; }
        .enunciado img { max-width: 100%; border-radius: 8px; margin: 20px 0; }
        
        .alternativas { display: grid; gap: 12px; }
        .opcao { display: flex; padding: 20px; border: 2px solid #f1f5f9; border-radius: 14px; cursor: pointer; transition: all 0.2s; align-items: center; background: white; }
        .opcao:hover { border-color: var(--primary); background: #f0f7ff; transform: translateX(5px); }
        .letra { min-width: 38px; height: 38px; background: #f1f5f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; margin-right: 15px; color: var(--primary); border: 2px solid transparent; }
        
        /* Feedback */
        .correct { border-color: #16a34a !important; background: #f0fdf4 !important; }
        .correct .letra { background: #16a34a; color: white; }
        .wrong { border-color: var(--accent) !important; background: #fef2f2 !important; }
        .wrong .letra { background: var(--accent); color: white; }
        
        #mentor-feedback { margin-top: 30px; padding: 30px; background: var(--dark); color: #f8fafc; border-radius: 18px; display: none; border-left: 6px solid var(--accent); animation: slideIn 0.4s ease; }
        
        /* Bot√µes */
        .btn-primary { background: var(--primary); color: white; border: none; padding: 18px 35px; border-radius: 12px; font-weight: 800; cursor: pointer; font-size: 1rem; transition: 0.3s; width: 100%; }
        .btn-primary:hover { filter: brightness(1.1); transform: translateY(-2px); }
        .btn-next { background: var(--dark); margin-top: 20px; width: auto; float: right; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="main-container">
    <div id="setup-screen" class="card" style="text-align: center;">
        <h1 style="font-size: 2.2rem; margin-bottom: 10px;">ü§ñ Mentor IA: Persona da Banca</h1>
        <p style="color: #64748b; margin-bottom: 35px;">Configure seu edital para iniciar o treinamento carrasco.</p>
        
        <div class="setup-group">
            <label>BANCA ALVO E CONCURSO</label>
            <input type="text" id="p-banca" placeholder="Ex: FGV - Receita Federal">
        </div>
        
        <div class="setup-group">
            <label>CARGO PRETENDIDO</label>
            <input type="text" id="p-cargo" placeholder="Ex: Auditor Fiscal">
        </div>
        
        <div class="setup-group">
            <label>CONTE√öDO PROGRAM√ÅTICO / DISCIPLINAS</label>
            <textarea id="p-edital" placeholder="Liste os principais t√≥picos ou mat√©rias..."></textarea>
        </div>

        <button class="btn-primary" onclick="iniciarTreinamento()">SINCRONIZAR E COME√áAR ‚ûî</button>
    </div>

    <div id="training-area" style="display:none">
        <div id="ai-loading" style="text-align: center; color: var(--primary); font-weight: 800; margin-bottom: 15px; display: none;">
            üß† ANALISANDO O EDITAL E ESCOLHENDO SUA PR√ìXIMA ARMADILHA...
        </div>

        <div id="quest-card" class="card">
            <div class="q-header">
                <span id="q-meta" class="q-badge">CARREGANDO...</span>
                <span id="q-id" style="font-weight: 800; color: #94a3b8;">ID: ---</span>
            </div>
            
            <div id="q-texto-assoc" style="display:none; background:#f8fafc; padding:20px; border-radius:12px; margin-bottom:20px; font-size: 0.95rem; border-left: 4px solid var(--primary);"></div>
            <div id="q-enunciado" class="enunciado"></div>
            
            <div id="q-alternativas" class="alternativas"></div>

            <div id="mentor-feedback"></div>
            
            <div style="margin-top: 30px; height: 60px;">
                <button id="btn-next" class="btn-primary btn-next" style="display:none" onclick="iaSelecionarProxima()">PR√ìXIMA QUEST√ÉO ‚ûî</button>
            </div>
        </div>
    </div>
</div>

<script>
    // CONFIGURA√á√ÉO DA CHAVE E BANCO
    const GROQ_KEY = "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"; // Cole sua chave Groq aqui
    const GITHUB_URL = "https://raw.githubusercontent.com/questaogabaritada-hue/meu-banco-questoes/main/banco_final.json";
    
    let bancoTotal = [];
    let perfilEstudo = {};
    let questaoAtual = null;
    let historicoErros = [];

    // 1. INICIALIZA√á√ÉO E DOWNLOAD DO BANCO ATUALIZADO
    async function iniciarTreinamento() {
        perfilEstudo = {
            banca: document.getElementById('p-banca').value,
            cargo: document.getElementById('p-cargo').value,
            edital: document.getElementById('p-edital').value
        };

        if(!perfilEstudo.banca || !perfilEstudo.cargo) return alert("Preencha os dados do seu concurso!");

        const btn = document.querySelector('.btn-primary');
        btn.innerText = "SINCRONIZANDO BANCO...";
        btn.disabled = true;

        try {
            // O "?v=" + Date.now() for√ßa o GitHub a enviar o arquivo mais recente, sem cache
            const resp = await fetch(GITHUB_URL + "?v=" + Date.now());
            bancoTotal = await resp.json();
            
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('training-area').style.display = 'block';
            
            iaSelecionarProxima();
        } catch (e) {
            alert("Erro ao conectar com o banco de quest√µes no GitHub.");
            btn.disabled = false;
            btn.innerText = "TENTAR NOVAMENTE";
        }
    }

    // 2. A IA AGE COMO CARRASCA E ESCOLHE A QUEST√ÉO
    async function iaSelecionarProxima() {
        document.getElementById('ai-loading').style.display = 'block';
        document.getElementById('btn-next').style.display = 'none';
        document.getElementById('mentor-feedback').style.display = 'none';
        
        // Cria cat√°logo reduzido para economizar tokens
        const catalogo = bancoTotal.map(q => ({ id: q.id, info: q.info, disciplinas: q.disciplinas })).slice(0, 150);

        try {
            const r = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${GROQ_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [
                        { role: "system", content: `Voc√™ √© o Coordenador de Provas da banca ${perfilEstudo.banca}. Seu objetivo √© preparar o aluno para o cargo de ${perfilEstudo.cargo}. Analise o cat√°logo e retorne APENAS o n√∫mero do ID da melhor quest√£o para testar o aluno agora, focando no edital: ${perfilEstudo.edital}. Se o aluno errou quest√µes anteriores (IDs: ${historicoErros.join(',')}), decida se deve repetir ou subir o n√≠vel.`},
                        { role: "user", content: `Cat√°logo: ${JSON.stringify(catalogo)}` }
                    ],
                    temperature: 0.2
                })
            });
            const d = await r.json();
            const idEscolhido = d.choices[0].message.content.replace(/\D/g, "");
            renderizarQuestao(idEscolhido);
        } catch (e) {
            // Fallback em caso de erro na rede
            renderizarQuestao(bancoTotal[Math.floor(Math.random() * bancoTotal.length)].id);
        }
    }

    // 3. EXIBI√á√ÉO DA QUEST√ÉO SELECIONADA
    function renderizarQuestao(id) {
        questaoAtual = bancoTotal.find(q => q.id == id) || bancoTotal[0];
        document.getElementById('ai-loading').style.display = 'none';
        
        document.getElementById('q-meta').innerText = questaoAtual.info;
        document.getElementById('q-id').innerText = `ID: ${questaoAtual.id}`;
        
        const areaAssoc = document.getElementById('q-texto-assoc');
        if(questaoAtual.htmlTextoAssociado || questaoAtual.txtAssoc) {
            areaAssoc.innerHTML = questaoAtual.htmlTextoAssociado || questaoAtual.txtAssoc;
            areaAssoc.style.display = 'block';
        } else { areaAssoc.style.display = 'none'; }

        document.getElementById('q-enunciado').innerHTML = questaoAtual.htmlEnunciado || questaoAtual.enunciado;

        const altsArea = document.getElementById('q-alternativas');
        altsArea.innerHTML = '';
        const letras = ['A', 'B', 'C', 'D', 'E'];

        questaoAtual.alts.forEach((texto, i) => {
            const div = document.createElement('div');
            div.className = 'opcao';
            div.innerHTML = `<div class="letra">${letras[i]}</div><div style="flex:1">${texto}</div>`;
            div.onclick = () => validarResposta(letras[i], div);
            altsArea.appendChild(div);
        });
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // 4. VALIDA√á√ÉO E FEEDBACK DA PERSONA CARRASCA
    async function validarResposta(escolha, elemento) {
        const todas = document.querySelectorAll('.opcao');
        todas.forEach(o => o.style.pointerEvents = 'none');

        const eCorreto = escolha === questaoAtual.gabarito;
        
        if(eCorreto) {
            elemento.classList.add('correct');
            document.getElementById('btn-next').style.display = 'block';
        } else {
            elemento.classList.add('wrong');
            todas.forEach(o => { 
                if(o.querySelector('.letra').innerText === questaoAtual.gabarito) o.classList.add('correct'); 
            });
            historicoErros.push(questaoAtual.id);
            gerarExplicacaoCarrasca();
        }
    }

    async function gerarExplicacaoCarrasca() {
        const box = document.getElementById('mentor-feedback');
        box.style.display = 'block';
        box.innerHTML = "<em>‚ö†Ô∏è O MENTOR EST√Å APONTANDO SUAS FALHAS...</em>";

        try {
            const r = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${GROQ_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "llama-3.1-8b-instant",
                    messages: [
                        { role: "system", content: `Voc√™ √© um Mentor Carrasco para o cargo de ${perfilEstudo.cargo}. O aluno errou uma quest√£o da banca ${perfilEstudo.banca}. Explique o erro de forma curta, t√©cnica e dura. N√£o tenha pena, foque em garantir que ele n√£o erre isso na prova real.`},
                        { role: "user", content: `Quest√£o: ${questaoAtual.enunciado}. Gabarito: ${questaoAtual.gabarito}.` }
                    ]
                })
            });
            const d = await r.json();
            box.innerHTML = `<strong>üíÄ RAIO-X DO CARRASCO:</strong><br><br>${d.choices[0].message.content.replace(/\n/g, '<br>')}`;
            document.getElementById('btn-next').style.display = 'block';
        } catch (e) {
            box.innerHTML = "Erro ao carregar explica√ß√£o. Apenas estude o gabarito e avance.";
            document.getElementById('btn-next').style.display = 'block';
        }
    }
</script>

</body>
</html>
